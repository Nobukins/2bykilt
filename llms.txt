actions:
  - name: script-nogtips
    type: script
    script: search_script.py
    params:
      - name: query
        required: true
        type: string
        description: "検索クエリ"
    command: python -m pytest myscript/search_script.py::test_nogtips_simple --query ${params.query} --no-cov
    slowmo: 2500

  - name: get-title
    type: browser-control
    slowmo: 1000
    params:
      - name: output_file
        required: false
        type: string
        description: "抽出結果を書き出すファイルパス (未指定時は自動生成)"
      - name: output_mode
        required: false
        type: string
        description: "ファイル書き込みモード。append (既定) または overwrite"
    flow:
      - action: command
        url: "https://nogtips.wordpress.com/"
        wait_until: "domcontentloaded"
      - action: scroll_to_bottom  # ページ下部へスクロールしてCookie同意ボタンを表示
      - action: extract_content
        selectors:
          - selector: "h1"

  - name: get-yahoo-news
    type: browser-control
    slowmo: 1000
    description: YAHOOニュースの抽出
    params:
      - name: output_file
        required: false
        type: string
        description: "抽出結果を書き出すファイルパス (未指定時は自動生成)"
      - name: output_mode
        required: false
        type: string
        description: "ファイル書き込みモード。append (既定) または overwrite"
    flow:
      - action: command
        url: "https://yahoo.co.jp/"
        wait_until: "domcontentloaded"
      - action: extract_content
        selectors:
          - selector: "h1"

  - name: search-nogtips
    type: browser-control
    slowmo: 1000
    params:
      - name: query
        required: true
        type: string
        description: "Search query to execute"
    flow:
      - action: command
        url: "https://nogtips.wordpress.com/"
        wait_until: "domcontentloaded"
      - action: scroll_to_bottom  # ページ下部へスクロールしてCookie同意ボタンを表示
      - action: click
        selector: "#eu-cookie-law > form > input"
      - action: click
        selector: "#search-2 > form > label > input"
      - action: fill_form
        selector: "#search-2 > form > label > input"
        value: "${params.query}"
      - action: keyboard_press
        selector: "Enter"
      - action: screenshot
        prefix: "nogtips_search"
        full_page: true
      - action: extract_content
        selectors:
          - selector: "h1"
            label: "primary_articles"
            fields:
              - text
              - html

  - name: phrase-search
    type: browser-control
    params:
      - name: query
        required: true
        type: string
        description: "Search query to execute"
    slowmo: 1000
    flow:
      - action: command
        url: "https://www.google.com"
        wait_for: "#APjFqb"
      - action: click
        selector: "#APjFqb"
        wait_for_navigation: true
      - action: fill_form
        selector: "#APjFqb"
        value: "${params.query}"
      - action: keyboard_press
        selector: "Enter"

  - name: site-defined-script
    type: git-script
    git: https://github.com/Nobukins/sample-tests.git
    script_path: search_script.py
    version: main
    params:
      - name: query
        required: true
        type: string
        description: "Search query to execute"
    command: python -m pytest ${script_path} --query ${params.query} --no-cov
    timeout: 120
    slowmo: 1000

  - name: search-jsonpayload
    type: unlock-future
    keep_tab_open: true
    params:
      - name: query
        required: true
        type: string
        description: "Search query to execute"
    flow:
      - action: command
        url: "https://www.google.com"
        wait_for: "#APjFqb"
      - action: click
        selector: "#APjFqb"
        wait_for_navigation: true
      - action: fill_form
        selector: "#APjFqb"
        value: "${params.query}"
      - action: keyboard_press
        key: "Enter"

  - name: click-jsonpayload
    type: unlock-future
    tab_selection_strategy: active_tab  # Explicitly specify active_tab
    keep_tab_open: true
    flow:
      - action: keyboard_press
        key: "Enter"

  - name: nogtips-jsonpayload
    type: unlock-future
    keep_tab_open: True
    tab_selection_strategy: new_tab  # 明示的に新規タブを指定
    params:
      - name: query
        required: true
        type: string
        description: "Search query to execute"
    slowmo: 1000
    flow:
      - action: command
        url: "https://nogtips.wordpress.com/"
        wait_until: "domcontentloaded"
      - action: click
        selector: "#eu-cookie-law > form > input"
      - action: click
        selector: "#search-2 > form > label > input"
      - action: fill_form
        selector: "#search-2 > form > label > input"
        value: "${params.query}"

  - name: action-runner-template-example
    type: action_runner_template
    template: templates/example_template.py
    params:
      - name: action
        required: true
        type: string
        description: "Action to execute"
    command: 'python ${template}'

  - name: demo-artifact-capture
    type: action_runner_template
    template: templates/artifact_capture_runner.py
    description: "デモ: スクリーンショットと要素抽出を自動実行"
    params:
      - name: browser
        required: false
        type: string
        description: "Playwright browser type (chromium/firefox/webkit)"
      - name: prefix
        required: false
        type: string
        description: "Artifact name prefix"
    command: python ${template} --variant demo --browser ${params.browser|chromium} --prefix ${params.prefix|demo_capture}

  - name: nogtips-artifact-capture
    type: action_runner_template
    template: templates/artifact_capture_runner.py
    description: "nogtips検索フローでアーティファクトを取得"
    params:
      - name: query
        required: true
        type: string
        description: "Search query to execute"
      - name: browser
        required: false
        type: string
        description: "Playwright browser type (chromium/firefox/webkit)"
      - name: prefix
        required: false
        type: string
        description: "Artifact name prefix"
    command: python ${template} --variant nogtips --query "${params.query}" --browser ${params.browser|chromium} --prefix ${params.prefix|nogtips_capture}
