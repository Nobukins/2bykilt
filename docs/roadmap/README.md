# Roadmap Documentation

This directory contains the project roadmap documentation and automated task management system.

## Core Files

### Source Data
- **`ISSUE_DEPENDENCIES.yml`** - Single source of truth for issue dependencies, priorities, and metadata
- **`DEPENDENCY_GRAPH.md`** - Visual dependency graph (auto-generated from ISSUE_DEPENDENCIES.yml)

### Generated Outputs  
- **`TASK_QUEUE.yml`** - Machine-readable task queue (⚠️ AUTO-GENERATED - DO NOT EDIT)
- **`TASK_DASHBOARD.md`** - Human-readable task dashboard (⚠️ AUTO-GENERATED - DO NOT EDIT)

### Documentation
- **`TASK_QUEUE_SPEC.md`** - Schema specification for TASK_QUEUE.yml
- **`ROADMAP.md`** - High-level project roadmap
- **`HOW_TO_PROMPT_TO_AGENT.md`** - Guidelines for working with AI agents

## Automation

### Daily Task Queue Generation

The task queue is automatically updated **once per day at 3 AM UTC** plus on relevant repository events:

```yaml
# Generated files are updated by GitHub Actions workflow
triggers:
  - schedule: "0 3 * * *"  # Daily at 3 AM UTC
  - workflow_dispatch       # Manual trigger
  - push to ISSUE_DEPENDENCIES.yml
  - issue/PR events
```

### Generated File Policy

**🚨 DO NOT MANUALLY EDIT GENERATED FILES**

Generated files include clear headers identifying them as auto-generated:

- `TASK_QUEUE.yml` - Generated by `scripts/generate_task_queue.py`
- `TASK_DASHBOARD.md` - Generated by `scripts/generate_task_dashboard.py`

To make changes:
1. Update `ISSUE_DEPENDENCIES.yml` 
2. Run generation scripts locally OR wait for next automation cycle
3. Generated files will be updated automatically

### Pre-PR Dependency Workflow (Summary)

The canonical, full checklist lives in `ROADMAP.md` Section K ("依存グラフ更新 / Pre-PR ローカル検証 & CI 方針"). For any PR that changes `ISSUE_DEPENDENCIES.yml`:

Minimal local steps (see full list for details):

1. Edit `ISSUE_DEPENDENCIES.yml` (add / update issue, progress, risk)
2. Validate: `python scripts/validate_dependencies.py docs/roadmap/ISSUE_DEPENDENCIES.yml`
3. Regenerate graph: `python scripts/gen_mermaid.py docs/roadmap/ISSUE_DEPENDENCIES.yml > docs/roadmap/DEPENDENCY_GRAPH.md`
4. Regenerate dashboard & queue: `python scripts/generate_task_dashboard.py` & `python scripts/generate_task_queue.py --repo <owner/repo> --input docs/roadmap/ISSUE_DEPENDENCIES.yml --output docs/roadmap/TASK_QUEUE.yml --no-api`
5. Validate queue: `python scripts/validate_task_queue.py --queue docs/roadmap/TASK_QUEUE.yml --dependencies docs/roadmap/ISSUE_DEPENDENCIES.yml`
6. Re-run generation to confirm zero diff (idempotent)
7. Update `ROADMAP.md` progress (Wave status) if completion state changed
8. Fill PR template fields (Docs Updated / Validation / Idempotent Check)

Avoid duplicating the checklist elsewhere—always treat Section K as the source of truth.

### Generation Scripts

Located in `scripts/` directory:

- **`generate_task_queue.py`** - Creates TASK_QUEUE.yml with prioritized, dependency-aware issue queue
- **`validate_task_queue.py`** - Validates generated queue for consistency and correctness
- **`generate_task_dashboard.py`** - Creates human-readable TASK_DASHBOARD.md
- **`validate_dependencies.py`** - Validates ISSUE_DEPENDENCIES.yml structure

### Manual Generation

For local development or testing:

```bash
# Generate task queue
python scripts/generate_task_queue.py \
  --repo Nobukins/2bykilt \
  --input docs/roadmap/ISSUE_DEPENDENCIES.yml \
  --output docs/roadmap/TASK_QUEUE.yml \
  --verbose

# Validate generated queue
python scripts/validate_task_queue.py --verbose

# Generate task dashboard (if implemented)
python scripts/generate_task_dashboard.py \
  --input docs/roadmap/ISSUE_DEPENDENCIES.yml \
  --output docs/roadmap/TASK_DASHBOARD.md
```

## Workflow Integration

The automation supports project management workflows:

1. **Planning**: Use TASK_QUEUE.yml to identify next available work
2. **Prioritization**: Issues ordered by critical path, priority, and dependencies  
3. **Dependency Management**: Blocked issues clearly identified with unmet dependencies
4. **Progress Tracking**: Status classification (ready/blocked/in_progress/done)
5. **Resource Allocation**: WIP limits and area-based parallelization constraints

## Status Categories

Issues are automatically classified into:

- **`ready`** - All dependencies met, available for work
- **`blocked`** - Waiting on unmet dependencies  
- **`in_progress`** - Active work (has open PR)
- **`done`** - Completed (closed issue/merged PR)

## Configuration

Generation behavior controlled by command-line options:

- `--wip-limit` - Maximum in-progress issues (default: 5)
- `--max-parallel-per-area` - Max concurrent work per functional area (default: 2)
- `--include-phases` - Filter to specific development phases
- `--exclude-risk` - Exclude high-risk or deprecated items
- `--ordering` - Multi-criteria sorting (critical_path_rank, priority, longest_distance)

## Schema Documentation

See [`TASK_QUEUE_SPEC.md`](TASK_QUEUE_SPEC.md) for complete schema specification, validation rules, and usage examples.

---

*For questions about roadmap automation, see project documentation or create an issue.*
